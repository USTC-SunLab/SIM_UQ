```markdown
# 不确定性建模与损失函数构建调研报告

## 前向模型中不确定性的传播方法
在具有乘法、卷积、调制等步骤的**结构化前向物理模型**中，可以通过**统计矩传播**的方法来跟踪均值和方差（或协方差）。对于**线性运算**（如仿射变换或卷积），均值和协方差的传播是直接的：线性变换下输出均值为变换矩阵乘以输入均值，输出协方差则可通过共轭变换得到。然而，**非线性运算**（如ReLU激活、乘法耦合等）使得解析传播变得复杂。为此，通常需要引入近似假设，例如假定进入非线性单元的分布为高斯分布，并执行一阶线性化或其它矩匹配技巧。Gast和Roth等人提出利用**假设密度过滤**（Assumed Density Filtering, ADF）的方法，将每一层的激活近似为高斯分布，从而以解析方式逐层传播均值和方差。例如，他们在CNN中用ADF成功地在不改变网络结构的情况下传播中间层的不确定性，并获得与真实误差相符的方差估计。早期工作也探索了特殊非线性的解析处理：Bibi等人（CVPR 2018）针对ReLU等分段线性网络，给出了输出概率矩（均值/方差）的解析表达，以评估输入噪声和对抗扰动的影响。近期更有研究给出了**非线性激活函数的精确协方差解**，例如推导了高斯输入通过Heaviside/ReLU/GELU的输出协方差闭式公式。  

对于**乘法或其他双目运算**的情形，如果两个隐变量 $X, Y$ 独立，可利用统计公式近似计算：$\mathbb{E}[XY]\approx \mathbb{E}[X]\mathbb{E}[Y]$，$\mathrm{Var}(XY)\approx (\mathbb{E}[X])^2\mathrm{Var}(Y)+(\mathbb{E}[Y])^2\mathrm{Var}(X)+\mathrm{Var}(X)\mathrm{Var}(Y)$。一般而言，独立随机变量之积的分布无简单解析形式，但在高斯小方差等假设下可以近似为高斯。指出两高斯随机变量相乘的分布难以直接求解，但在方差较小时可用近似公式得到其均值和方差。类似地，在**卷积点扩散（PSF）不确定**的情况下，如果PSF参数和待成像物理场均有高斯不确定性，可尝试通过展开卷积积分并应用协方差传播来近似输出分布。这些方法通常需要假定不同不确定源相互独立或弱相关，从而将复杂的**误差传播**问题转化为各部分方差的累积和传播问题。总的来说，线性步骤的不确定性传播相对直接，而非线性步骤（乘法、门控等）则依赖于**高斯假设+泰勒展开**或**不确定性采样**等技术来获得均值和方差的近似推断。

## 概率损失函数的构建方法
为了在训练中纳入上述不确定性，需要设计**符合概率推断的损失函数**，典型做法是最大化观测数据在网络**预测分布**下的似然。例如，将网络预测的输出视为高斯分布 $N(\mu(x),\,\sigma^2(x))$，其中$\mu(x)$和$\sigma(x)$分别是网络预测的均值和标准差，则对给定观测值$y$，可以构造**异方差高斯负对数似然损失**: 

$$
L = \frac{1}{2\sigma(x)^2}\|y-\mu(x)\|^2 + \frac{1}{2}\log[\sigma(x)^2]\,,
$$

该损失源自高斯似然的负对数形式，其第一项根据预测方差自适应地加权误差平方，第二项为对预测方差的正则。Kendall和Gal（NIPS 2017）率先在计算机视觉任务中采用此策略，让网络同时输出预测值和对应的不确定性，并通过上述损失训练，从而**学习观测噪声的异方差程度**。这种方法等价于让网络学会对噪声较大的样本降低损失权重（即“loss attenuation”），在深度估计、分割等任务上提高了鲁棒性。除了高斯模型外，一些工作使用**拉普拉斯分布**建模残差，从而构建类似的**L1范数加logσ损失**（对应拉普拉斯似然的对数形式）。例如，医学影像重建中的CARE方法就使用了**拉普拉斯似然**来估计超分辨重建的不确定性分布。这种Laplace模型实质上让损失对离群误差更不敏感，同时输出一个尺度参数描述不确定性。

在一些更复杂情境下，还会在损失中融入先验约束。例如Chang等人（IEEE TCI 2025）在深度学习SIM重建中设计了**稀疏约束的异方差损失**，引入Jeffreys先验来规范网络输出的不确定性图。Jeffreys先验（对方差的非信息先验）本质上在损失中带来$\sim\!-\log\sigma$的项，可防止网络预测无限大的不确定性来逃避误差惩罚。他们的两阶段方法首先通过该损失训练网络获得每个像素的**不确定性地图**，这些不确定性反映了网络对输出的信心水平，并能定位潜在不准确区域。第二阶段再利用预测的不确定性图作为注意力，引导网络关注高不确定区域以改进重建细节。类似地，一些Bayesian模型中会对预测方差加入适当正则，使得模型**既能拟合数据又不至于因为噪声导致方差发散**。总的来说，此类损失函数（如异方差NLL）保证了训练过程与**最大似然估计**兼容：网络学习到的均值-方差输出能够提高观测数据的对数似然，从而实现概率意义下的最优拟合。

## 应用案例：显微成像、物理仿真和神经场中的不确定性建模
**显微超分辨成像**领域已出现多种将上述思想付诸实践的案例。例如，Liu等人提出的**BayesDL-SIM**方法（Nat. Commun. 2025）将贝叶斯深度学习引入结构光照显微镜（SIM）重建。该方法在训练时对网络权重施加**SGLD贝叶斯推断**，获取模型参数的不确定性（后验分布），并让网络输出每个像素的高斯分布（均值和标准差）来表征重建图像的不确定性。在推理阶段，他们对网络权重采样多个实例，获得多次重建并计算**预测均值**作为最终图像，同时统计两类不确定性：一是每个实例网络输出的固有**像素方差**的均值（即**观测噪声不确定性**，AleaU），二是不同权重实例之间预测差异形成的**模型不确定性**（EpisU）。实验表明，BayesDL-SIM能够**像素级地给出重建强度的均值和标准差**，其预测的不确定性和真实误差具有良好校准，能够覆盖所有可能的SR解空间。例如，对于一些微管、F-肌动蛋白等结构，模型输出的每像素高斯分布的置信区间与真实高分辨强度的落点频率非常接近理想校准曲线，表明该方法精准捕获了重建分布。相比之下，以往深度SIM方法只给出单一重建结果，无法量化这种不确定性。除BayesDL-SIM外，Chang等人（TCI 2025）和Lin等人（2025）也分别提出了**不确定性引导的SIM重建**方法。其中，Chang等的模型输出**不确定性地图**辅助重建，并利用先验约束提升了不确定性估计的准确性。Lin等人的**PG-SIM**方法则将**光学先验**融入贝叶斯神经网络，通过图神经网络编码SIM成像物理过程，提高了重建的可靠性。PG-SIM不仅提供了成像结果对应的**不确定性和置信度图**以供生物学家定量评估成像误差，还通过融合物理先验显著降低了重建的不确定性。这些工作体现了在显微成像逆问题中**显式建模不确定性传播**的价值：模型可以识别哪些结构重建得不可靠，提示用户谨慎解释，并在算法上避免过度拟合噪声或输出伪影。

在**物理仿真建模**领域，类似的思想也逐渐受到重视。例如在**物理规律驱动的神经网络**（PINNs）中，研究者开始引入**贝叶斯PINN**来量化对解的置信度。通过对网络参数实行贝叶斯推断或随机化技术，这类模型可以给出**仿真输出的概率分布**而非单一点估计。例如，针对求解偏微分方程的PINN，Bayesian PINN方法将网络参数视为随机变量，得到预测场的方差场，从而评估解的不确定区域。又如在机器人控制或轨迹物理模拟中，也有工作使用**深度导出的卡尔曼滤波**或**Unscented变换**，将传感器和动力学模型的不确定性沿时间传播，提供对系统状态预测的置信区间。这些方法与上述显微成像的思想一致：通过在前向模型中引入随机性和概率推断，跟踪不确定性的演化，最终使模型输出带有可信度标记，满足安全关键应用对可靠性的要求。

在**神经辐射场（NeRF）等神经场模型**中，近期也出现了对**不确定性传播**的显式建模。NeRF的前向渲染涉及沿摄像视线对空间中的颜色和密度场积分，这一过程包含**连续累积和乘积运算**（例如颜色受到沿射线累积的不透明度调制）。Lee等人（ECCV 2024）提出了**Bayesian NeRF**，通过假定体密度和颜色为随机场，推导了体渲染公式下预测像素颜色的均值和方差表达。具体而言，他们假设每段体素密度服从高斯分布且独立，同一射线上的颜色值近似为这些高斯变量的线性组合，从而**得到输出颜色近似服从高斯分布**。在此基础上，作者将最大似然估计（MLE）融入训练：优化目标不再仅是最小化像素误差，而是**最大化观测像素在预测高斯分布下的概率**。这等价于在渲染过程中传播密度的不确定性到像素级别，并通过对数似然损失来训练NeRF使其输出分布与真实分布吻合。从结果看，Bayesian NeRF能够在数据稀少或未观测视角下给出**像素不确定性估计**，在RGB和深度预测上均提升了性能和可靠性。值得注意的是，当同时考虑密度和颜色的不确定性时，每条射线上的像素颜色是两个高斯随机变量之积的累积，这在严格数学上分布是不可解的。然而作者采用了方差较小时的近似，使该乘积的分布仍可近似为高斯并求出参数。除了Bayesian NeRF以外，还有其他方法通过集成学习来量化NeRF的不确定性。例如，有研究使用**NeRF模型集合**来估计不确定度，发现模型集成不仅提供了不确定量化，还改善了新视角下渲染的鲁棒性。另有**Bayes’ Rays**方法则在训练后对已有NeRF模型施加后验近似（如Laplace近似），以**后验采样**来评估任意预训练NeRF的体密度不确定性。总体而言，这些神经场领域的探索表明，将**概率推断和不确定性传播**融入复杂的物理渲染模型（如体绘制）的确可行：通过合理的统计假设（高斯近似、马尔可夫假设等），可以在保证计算可控的同时，为每个渲染像素提供方差估计乃至完整的分布描述。这不但提升了模型对未知视角的鲁棒性，也为下游任务（如主动视角选择、基于不确定性的优化等）奠定了基础。

**总结：**在包含复杂物理先验的神经网络模型中引入不确定性建模，关键在于找到**可传播的分布近似**和**相应的损失函数**。现有研究已经在显微成像重建、物理仿真求解、神经渲染等领域给出了成功案例：通过让网络输出显式的均值-方差，并将观测数据视为由该分布生成，利用对数似然损失训练网络，可以有效地跟踪并量化前向过程中的误差传递。这些方法有的假设中间变量服从高斯并解析传播协方差；有的采用采样（如蒙特卡洛Dropout、SGLD）获得预测分布；还有的结合先验优化分布形状（如Jeffreys先验约束）以提升估计稳定性。总之，**不确定性传播与概率损失**在深度学习与物理模型融合的场景中正发挥越来越重要的作用，它不仅提高了模型的可靠性和可解释性，也为在安全关键领域部署深度模型提供了必要的置信度保障。 

## 参考文献
1. Oren Wright et al. *An Analytic Solution to Covariance Propagation in Neural Networks.* AISTATS 2024
2. Jochen Gast, Stefan Roth. *Lightweight Probabilistic Deep Networks.* CVPR 2018
3. Alex Kendall, Yarin Gal. *What Uncertainties Do We Need in Bayesian Deep Learning for Computer Vision?* NIPS 2017
4. Tao Liu et al. *Bayesian deep-learning structured illumination microscopy enables reliable super-resolution imaging with uncertainty quantification.* Nat. Commun. 16, 5027 (2025)
5. Xuyang Chang et al. *Structured Illumination Microscopy With Uncertainty-Guided Deep Learning.* IEEE TCI 2025
6. Sibeak Lee et al. *Bayesian NeRF: Quantifying Uncertainty with Volume Density in Neural Radiance Fields.* ECCV 2024
7. Yunhao Zhong et al. *NeRF-Ensembles: Uncertainty Quantification for Neural Radiance Fields.* Inf. Sci. 2024
8. Junjie Zhang et al. *Bayes’ Rays: Uncertainty Quantification for Neural Radiance Fields.* CVPR 2024
9. Jeremy Diamzon, Daniele Venturi. *Uncertainty propagation in feed-forward neural network models.* Neural Networks 194 (2026)
10. Kun Lin et al. *Toward reliable fluorescence imaging: Optical prior-guided probabilistic reconstruction for structured illumination microscopy (PG-SIM).* (Preprint, 2025)
```
